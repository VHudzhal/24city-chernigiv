(function(){var t,e,o;function i(t,e){var o,i;if(this.options={target:"instafeed",get:"popular",resolution:"thumbnail",sortBy:"none",links:!0,mock:!1,useHttp:!1,afterLoad:null,api:"old"},"object"==typeof t)for(o in t)i=t[o],this.options[o]=i;this.context=null!=e?e:this,this.unique=this._genKey()}i.prototype.hasNext=function(){return"string"==typeof this.context.nextUrl&&0<this.context.nextUrl.length},i.prototype.next=function(){return!!this.hasNext()&&this.run(this.context.nextUrl)},i.prototype.run=function(t){var e,o;if("string"!=typeof this.options.accessToken)throw new Error("Missing accessToken.");return null!=this.options.before&&"function"==typeof this.options.before&&this.options.before.call(this),"undefined"!=typeof document&&null!==document&&((o=document.createElement("script")).id="instafeed-fetcher",o.src=t||this._buildUrl(),document.getElementsByTagName("head")[0].appendChild(o),e="instafeedCache"+this.unique,window[e]=new i(this.options,this),window[e].unique=this.unique),!0},i.prototype.parse=function(t){var e,o,i,n,s,r,a,p,l,h,u,c,d,f,m,g,y,w,_;if("object"!=typeof t){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"Invalid JSON data"),!1;throw new Error("Invalid JSON response")}if(0===t.data.length){if(null!=this.options.error&&"function"==typeof this.options.error)return this.options.error.call(this,"No images were returned from Instagram"),!1;throw new Error("No images were returned from Instagram")}if(null!=this.options.success&&"function"==typeof this.options.success&&this.options.success.call(this,t),this.context.nextUrl="",null!=t.pagination&&(this.context.nextUrl=t.pagination.next_url),"none"!==this.options.sortBy)switch(g="least"===(y="random"===this.options.sortBy?["","random"]:this.options.sortBy.split("-"))[0],y[1]){case"random":t.data.sort(function(){return.5-Math.random()});break;case"recent":t.data=this._sortBy(t.data,"created_time",g);break;case"liked":t.data=this._sortBy(t.data,"likes.count",g);break;case"commented":t.data=this._sortBy(t.data,"comments.count",g);break;default:throw new Error("Invalid option for sortBy: '"+this.options.sortBy+"'.")}if("undefined"!=typeof document&&null!==document&&!1===this.options.mock){if(h=t.data,m=parseInt(this.options.limit,10),null!=this.options.limit&&h.length>m&&(h=h.slice(0,m)),s=document.createDocumentFragment(),null!=this.options.filter&&"function"==typeof this.options.filter&&(h=this._filter(h,this.options.filter)),null!=this.options.template&&"string"==typeof this.options.template){for(r="",_=document.createElement("div"),a=0,c=h.length;a<c;a++){p=h[a],l="new"===this.options.api?p.media_url:p.images.standard_resolution.url,"VIDEO"===p.media_type&&(l=p.thumbnail_url),0<=window.location.protocol.indexOf("http")&&!this.options.useHttp&&(l=l.replace(/https?:\/\//,"//"));var b=[!0];"old"===this.options.api&&""!==this.options.tagName&&this.options.tagName.forEach(function(t,e){-1===p.tags.indexOf(t)?b[e]=!1:b[e]=!0}),-1!==b.indexOf(!0)&&(r+=this._makeTemplate(this.options.template,{model:p,id:p.id,link:"old"===this.options.api?p.link:p.permalink,type:p.media_type,image:l,orientation:"square",caption:this._getObjectProperty(p,"old"===this.options.api?"caption.text":"caption"),likes:"old"===this.options.api&&p.likes.count,comments:"old"===this.options.api&&p.comments.count,location:this._getObjectProperty(p,"location.name")}))}for(_.innerHTML=r,i=[],o=0,e=_.childNodes.length;o<e;)i.push(_.childNodes[o]),o+=1;for(this.options.afterLoad(),b=0,d=i.length;b<d;b++)f=i[b],s.appendChild(f)}if("string"==typeof(w=this.options.target)&&(w=document.getElementById(w)),null==w)throw n='No element with id="'+this.options.target+'" on page.',new Error(n);w.appendChild(s),document.getElementsByTagName("head")[0].removeChild(document.getElementById("instafeed-fetcher")),u="instafeedCache"+this.unique,window[u]=void 0;try{delete window[u]}catch(t){}}return null!=this.options.after&&"function"==typeof this.options.after&&this.options.after.call(this),!0},i.prototype._buildUrl=function(){var t,e,o;switch(t="new"===this.options.api?"https://graph.instagram.com":"https://api.instagram.com/v1",this.options.get){case"popular":e="media/popular";break;case"user":e="new"===this.options.api?"me/media?fields=id,media_type,media_url,username,timestamp,permalink,caption,children,thumbnail_url":"users/self/media/recent";break;default:throw new Error("Invalid option for get: '"+this.options.get+"'.")}return o=t+"/"+e,null!=this.options.accessToken&&(o+="new"===this.options.api?"&":"?",o+="access_token="+this.options.accessToken),o+="&callback=instafeedCache"+this.unique+".parse"},i.prototype._genKey=function(){var t;return""+(t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)})()+t()+t()+t()},i.prototype._makeTemplate=function(t,e){var o,i,n,s,r;for(i=/(?:\{{2})([\w\[\]\.]+)(?:\}{2})/,o=t;i.test(o);)s=o.match(i)[1],r=null!=(n=this._getObjectProperty(e,s))?n:"",o=o.replace(i,function(){return""+r});return o},i.prototype._getObjectProperty=function(t,e){var o,i;for(i=(e=e.replace(/\[(\w+)\]/g,".$1")).split(".");i.length;){if(o=i.shift(),!(null!=t&&o in t))return null;t=t[o]}return t},i.prototype._sortBy=function(t,n,s){var e;return e=function(t,e){var o,i;return o=this._getObjectProperty(t,n),i=this._getObjectProperty(e,n),s?i<o?1:-1:o<i?1:-1},t.sort(e.bind(this)),t},i.prototype._filter=function(t,e){var o,i,n,s;for(o=[],i=function(t){if(e(t))return o.push(t)},n=0,s=t.length;n<s;n++)i(t[n]);return o},t=i,e=this,o=function(){return t},"function"==typeof define&&define.amd?define([],o):"object"==typeof module&&module.exports?module.exports=o():e.Instafeed=o()}).call(this);